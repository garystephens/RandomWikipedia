<html>
<head>
	<title>Random Wikipedia Page Selector</title>

	<meta name="viewport" content="width=device-width, initial-scale=1">

	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-128490828-1"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag() { dataLayer.push(arguments); }
		gtag('js', new Date());

		gtag('config', 'UA-128490828-1');
	</script>

	<script src="https://code.jquery.com/jquery-3.3.1.min.js"
			integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
			crossorigin="anonymous"></script>

	<script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>

	<script type="text/javascript" src="paths.js"></script>
	<link rel="stylesheet" type="text/css" href="styles.css">

	<script>

		function requestOpenRandomPage() {
			var topN = $("#topN").val();
			saveValueForTopN(topN);
			logToGoogleAnalytics(topN);
			openPageIfTopNValid(topN);
		}

		function openPageIfTopNValid(topN) {
			var url;
			var rank;

			if (isNaN(topN) || Number(topN) > paths.length) {
				alert("Please enter a number less than or equal to " + paths.length)
			} else {
				rank = Math.floor(Math.random() * Number(topN));
				url = "https://en.wikipedia.org/wiki/" + paths[rank];
				window.open(url);
				$("#lastPageOpened").text(url).attr("href", url);
				$("#rank").text("(rank " + rank + ")");
			}
		}

		function logToGoogleAnalytics(topN) {
			gtag('event', topN, {
				'event_category': 'open',
				'event_label': topN,
				'value': Number(topN)
			});
		}

		function saveValueForTopN(topN) {
			Cookies.set('topN', topN, { expires: 999999 });
		}

		function useSavedValueForTopN() {
			var topN = Cookies.get('topN');
			if (topN !== undefined) {
				$("#topN").val(topN);
			}
		}

		$(document).ready(function () {
			useSavedValueForTopN();
		});

	</script>

</head>
<body>
	<br />
	<h1>Random Wikipedia Page Selector</h1>
	<br />
	<input style="font-size:16px; font-weight:bold;" type="button" onclick="requestOpenRandomPage()" value="Open Random Page" />
	<br />
	<br />
	<br />
	Select page from top <input id="topN" type="text" value="5000" style="width:60px"> Wikipedia entries*
	<br />
	(maximum 200,000)
	<br />
	<br />
	Last page opened:
	<a id="lastPageOpened" href="" target="_new"></a>
	<span id="rank"></span>
	<br />
	<br />
	<span class="smallprint">* Pages are sorted based on their Google <a href="https://en.wikipedia.org/wiki/PageRank">PageRank</a> score.</span>
	<br />
	<br />
	<span class="smallprint">Page developed by <a href="http://www.twitter.com/garystephens">Gary Stephens</a></span>
</body>
</html>

